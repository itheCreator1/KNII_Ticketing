<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
        crossorigin="anonymous">
  <link rel="stylesheet" href="/css/custom.css">
</head>
<body class="bg-light">
  <%- include('../partials/header') %>

  <main class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>
        <span class="badge bg-success text-white me-2">Department</span>
        Create Department Ticket
      </h2>
      <a href="/admin/dashboard" class="btn btn-outline-secondary">Back to Dashboard</a>
    </div>

    <%- include('../partials/flash') %>

    <div class="alert alert-info">
      <strong>Department Ticket:</strong> This ticket will be visible to department users in the selected department. Use this to create tickets on behalf of departments (e.g., phone requests, email submissions). The ticket will appear in their dashboard as if they submitted it.
    </div>

    <div class="card shadow-sm">
      <div class="card-body p-4">
        <form action="/admin/tickets/department" method="POST">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">

          <div class="mb-3">
            <label for="title" class="form-label">Issue Title *</label>
            <input type="text" id="title" name="title" class="form-control" required
                   placeholder="Brief description of the issue">
          </div>

          <div class="mb-3">
            <label for="description" class="form-label">Description *</label>
            <textarea id="description" name="description" rows="6" class="form-control" required
                      placeholder="Detailed description of the issue"></textarea>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="reporter_name" class="form-label">Reporter Name *</label>
              <input type="text" id="reporter_name" name="reporter_name" class="form-control" required
                     placeholder="Department contact name">
              <div class="form-text">Name of the department contact reporting this issue</div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="reporter_department" class="form-label">Department *</label>
              <select id="reporter_department" name="reporter_department" class="form-select" required>
                <option value="">Select Department</option>
                <% departments.forEach(dept => { %>
                  <option value="<%= dept.name %>"><%= dept.name %></option>
                <% }) %>
              </select>
              <div class="form-text">
                The department this ticket belongs to. It will appear in their dashboard.
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="reporter_phone" class="form-label">Phone Number (optional)</label>
              <input type="tel" id="reporter_phone" name="reporter_phone" class="form-control"
                     placeholder="+1 (555) 123-4567">
            </div>

            <div class="col-md-6 mb-3">
              <label for="priority" class="form-label">Priority</label>
              <select id="priority" name="priority" class="form-select">
                <option value="unset">Unset</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="critical">Critical</option>
              </select>
            </div>
          </div>

          <div class="alert alert-secondary">
            <strong>Note:</strong> This ticket will automatically start with status "Open" and will be visible to the selected department's users.
          </div>

          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-success btn-lg">Create Department Ticket</button>
            <a href="/admin/dashboard" class="btn btn-outline-secondary">Cancel</a>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
          crossorigin="anonymous"></script>
</body>
</html>
